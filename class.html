<!doctype html>
<html lang="uk">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, user-scalable=yes, viewport-fit=cover" />
    <title>–†–æ–∑–∫–ª–∞–¥ —É—Ä–æ–∫—ñ–≤ | –®–∫–æ–ª–∞</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Manrope:wght@400;500;600;700;800&family=Rubik:wght@500;600;700;800&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="./class-page.css" />
  </head>
  <body class="class-page">
    <div class="site-bg" aria-hidden="true"></div>

    <div class="app" id="top">
      <header class="hero">
        <div class="hero__row">
          <div class="hero__top-tools">
            <aside class="kyiv-clock" data-kyiv-clock aria-live="polite">
              <p class="kyiv-clock__title">–ö–∏—ó–≤—Å—å–∫–∏–π —á–∞—Å</p>
              <p class="kyiv-clock__date" data-kyiv-date>‚Äî</p>
              <p class="kyiv-clock__time" data-kyiv-time>--:--</p>
              <p class="kyiv-clock__sync" data-kyiv-sync>–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è‚Ä¶</p>
            </aside>
          </div>
          <h1 id="classPageTitle">–†–æ–∑–∫–ª–∞–¥ —É—Ä–æ–∫—ñ–≤</h1>
          <span class="hero__title-icon hero__title-icon--school" aria-hidden="true">üè´</span>
        </div>
        <p class="hero__school" id="schoolName">–®–∫–æ–ª–∞</p>
        <p class="hero__subtitle" id="semesterLabel">–Ü–Ü —Å–µ–º–µ—Å—Ç—Ä</p>

        <div class="hero__main-actions">
          <button class="action-btn action-btn--back action-btn--hero" id="backButton" type="button">–ü–æ–≤–µ—Ä–Ω—É—Ç–∏—Å—å –Ω–∞ –≥–æ–ª–æ–≤–Ω—É</button>
        </div>

        <nav class="class-switch" id="classSwitch" aria-label="–ù–∞–≤—ñ–≥–∞—Ü—ñ—è –ø–æ –∫–ª–∞—Å–∞—Ö"></nav>
      </header>

      <section class="day-card" aria-label="–†–æ–∑–∫–ª–∞–¥ –∫–ª–∞—Å—É">
        <div class="day-header">
          <h2 class="day-title">–ù–∞–≤—á–∞–ª—å–Ω–∏–π —Ç–∏–∂–¥–µ–Ω—å</h2>
          <div class="day-actions">
            <button class="action-btn action-btn--print" id="printButton" type="button">–î—Ä—É–∫</button>
          </div>
        </div>

        <div class="table-wrap">
          <table id="classTable">
            <thead>
              <tr id="headRow"></tr>
            </thead>
            <tbody id="bodyRows"></tbody>
          </table>
        </div>
      </section>

      <footer class="footer">
        <p>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –Ω–∞ –ø—Ä–µ–¥–º–µ—Ç —É —Ç–∞–±–ª–∏—Ü—ñ, —â–æ–± –ø—ñ–¥—Å–≤—ñ—Ç–∏—Ç–∏ –≤—Å—ñ –∑–±—ñ–≥–∏ –Ω–∞ —Å—Ç–æ—Ä—ñ–Ω—Ü—ñ.</p>
      </footer>
    </div>

    <script src="./schedule-config.js"></script>
    <script src="./schedule-core.js"></script>
    <script src="./kyiv-clock.js"></script>
    <script>
      (() => {
        const config = window.SchoolScheduleConfig;
        const core = window.ScheduleCore;
        if (!config || !core) {
          return;
        }

        const className = core.resolveClassFromQuery(config);
        if (!className) {
          return;
        }

        const dayOrder = config.dayOrder || [];
        const aliasMap = config.subjectAliasMap || {};
        const subjectIcons = config.subjectIcons || {};

        const escapeHtml = core.escapeHtml;
        const classPageHref = (name) => core.classPageHref(config, name);
        const splitCellSubjects = (raw) => core.splitCellSubjects(raw, aliasMap, subjectIcons);

        const titleNode = document.getElementById("classPageTitle");
        const schoolNode = document.getElementById("schoolName");
        const semesterNode = document.getElementById("semesterLabel");
        const switchNode = document.getElementById("classSwitch");
        const headRow = document.getElementById("headRow");
        const bodyRows = document.getElementById("bodyRows");
        const classTable = document.getElementById("classTable");

        const schoolName = config.school?.name || "–®–∫–æ–ª–∞";
        const semesterLabel = config.school?.semesterLabel || "–ù–∞–≤—á–∞–ª—å–Ω–∏–π —Ä—ñ–∫";
        document.title = `–†–æ–∑–∫–ª–∞–¥ —É—Ä–æ–∫—ñ–≤ ${className} | ${schoolName}`;
        if (titleNode) {
          titleNode.textContent = `–†–æ–∑–∫–ª–∞–¥ —É—Ä–æ–∫—ñ–≤ ${className}`;
        }
        if (schoolNode) {
          schoolNode.textContent = schoolName;
        }
        if (semesterNode) {
          semesterNode.textContent = semesterLabel;
        }

        if (switchNode) {
          switchNode.innerHTML = (config.classes || [])
            .map((name) => {
              const activeClass = name === className ? " class=\"is-active\"" : "";
              return `<a${activeClass} href="${classPageHref(name)}">${escapeHtml(name)}</a>`;
            })
            .join("");
        }

        if (headRow) {
          headRow.innerHTML =
            "<th>–£—Ä–æ–∫</th>" +
            dayOrder.map((day) => `<th>${escapeHtml(day.label)}</th>`).join("");
        }

        if (classTable) {
          const minWidth = Math.max(780, 74 + dayOrder.length * 160);
          classTable.style.minWidth = `${minWidth}px`;
        }

        const weekRows = core.getClassWeekMatrix(config, className);
        if (bodyRows) {
          bodyRows.innerHTML = weekRows
            .map((row) => {
              const dayCells = row.values
                .map((rawValue) => {
                  const subjects = splitCellSubjects(rawValue);
                  if (!subjects.length) {
                    return '<td class="empty-cell">‚Äî</td>';
                  }

                  const firstSubject = subjects[0];
                  const icon = firstSubject?.icon || "üìò";
                  return (
                    "<td>" +
                    `<span class="emoji">${escapeHtml(icon)}</span>` +
                    `<span class="subject-name">${escapeHtml(rawValue)}</span>` +
                    "</td>"
                  );
                })
                .join("");

              return `<tr><th>${row.lesson}</th>${dayCells}</tr>`;
            })
            .join("");
        }
      })();
    </script>
    <script src="./class-page.js"></script>
  </body>
</html>
